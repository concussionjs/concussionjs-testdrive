<!DOCTYPE html>
<html>
<head>
	<title>ConcussionJS</title>
	<meta charset="utf-8">
	<script src="ace.js"></script>
	<script src="mode-html.js"></script>
	<script src="theme-concussion.js"></script>
	<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>-->
	<script src="jquery-1.8.1.min.js"></script>
	<script src="assets/js/cjs-utilities.js" type="text/javascript"></script>
	<script>
		var myId="";
		var editor;

		 (function(d){
 		    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
 		    if (d.getElementById(id)) {return;}
 		    js = d.createElement('script'); js.id = id; js.async = true;
 		    js.src = "//connect.facebook.net/en_US/all.js";
 		    ref.parentNode.insertBefore(js, ref);
 		  }(document));

 		window.fbAsyncInit = function() {
 		   FB.init({
		 	 appId      : '231629423618271', // App ID
 		     //channelUrl : 'http://concussionjs.COM/channel.html', // Channel File
 		     status     : true, // check login status
 		     cookie     : true, // enable cookies to allow the server to access the session
 		     xfbml      : true  // parse XFBML
 		   });
		
 		   // Additional initialization code here

 		 // Load the SDK Asynchronously
 		

 		    // listen for and handle auth.statusChange events
        FB.Event.subscribe('auth.statusChange', function(response) {
        	//alert(JSON.stringify(response));
          if (response.authResponse) {
            // user has auth'd your app and is logged into Facebook
            FB.api('/me', function(me){
         		//alert(JSON.stringify(me));
				myId = me.id;
				//alert(myId);
				if (me.name) {
					document.getElementById('auth-displayname').innerHTML = me.name;
				}
				getPage(myId,"index",submitFormData);
            })
            document.getElementById('auth-loggedout').style.display = 'none';
            document.getElementById('auth-loggedin').style.display = 'block';
          } else {
            // user has not auth'd your app, or is not logged into Facebook
            document.getElementById('auth-loggedout').style.display = 'block';
            document.getElementById('auth-loggedin').style.display = 'none';
          }
        });

        // respond to clicks on the login and logout links
        $('#masthead-icon-facebook').click(function(){FB.login();});
        $('#auth-logoutlink').click(function(){FB.logout();}); 
      } 

		
		$(document).ready(function(){
			editor = ace.edit("editor");
			editor.setTheme("ace/theme/idle_fingers");
			editor.getSession().setMode("ace/mode/html");
			editor.setShowPrintMargin(false);
			if(!readCookie("sessionId"))
			{
				//alert("inside no cookie");
				createCookie("sessionId",createUUID(),1);
			}

			if(!myId)
			{	
				editor.getSession().setValue("<html>\r\n<head>\r\n    <title>Contacts</title>\r\n    <meta charset=\"utf-8\">\r\n\t<link rel=\"stylesheet\" href=\"contacts-style.css\">\r\n</head>\r\n\t<body>\r\n        <form data-bind=\"submit:contacts_create\">\r\n        <div class=\"new-contact\">\r\n\t\t\t<input class=\"fn\" type=\"text\" placeholder=\"Contact Name\" data-bind=\"value:contacts_Name\">\r\n\t\t\t<input class=\"phone\" type=\"text\" placeholder=\"Phone Number\" data-bind=\"value:contacts_phoneNumber\">\r\n\t\t\t<input class=\"email\" type=\"text\" placeholder=\"Email Address\" data-bind=\"value:contacts_emailAddress\">\r\n            <button type=\"submit\" value=\"Save\">Add record</button>    \r\n\t    </div>\r\n        </form>\r\n\t    <div id=\"contacts\" data-bind=\"foreach:contacts\">\r\n        \t<div class=\"vcard\">\r\n    \t\t\t<input class=\"fn\" data-bind=\"value:Name\">\r\n    \t\t\t<input class=\"tel\" data-bind=\"value:phoneNumber\">\r\n                <input class=\"tel\" data-bind=\"value:emailAddress\">\r\n                <button data-bind=\"click:contacts_update\">Save</button><button data-bind=\"click:contacts_delete\">Delete</button>\r\n    \t\t</div>\r\n        </div>\r\n </body>\r\n</html>");

					
					/*"<html>\n\t<body>\n\t\t<div data-bind=\"foreach:saturday\"><br>\n\t\t\t<span data-bind=\"text:questionTitle\"></span> - \n\t\t\t<span data-bind=\"text:questionBody\"></span>\n\t\t</div>\n\t\t<form data-bind=\"submit:saturday_create\">\n\t\t\tQuestion title\n\t\t\t<input data-bind=\"value:saturday_questionTitle\"><br>\n\t\t\tQuestion body \n\t\t\t<input data-bind=\"value:saturday_questionBody\"></br>\n\t\t\t<input type=\"submit\" value=\"add question\">\n\t\t</form>\n\t</body>\n</html>");*/

				submitFormData(readCookie("sessionId"));
			}
			else
			{
				getPage(myId,"next");
			}

			$("#panel-header-icon-save").click(function(event){
					//alert("clicked");
					submitFormData();
			});	
		});
function getPage(userId,filename,callback)
{
	$.ajax({
		//url: "http://testdrive.shift.com/getMergedJSandHTML/"+sessionId,
         url: "http://testdrive.concussionjs.com/pages/getEntryWhere/?id="+userId+"&name="+filename,
         type: "get", 
         dataType:"text",
         success: function(result) 
		{ 
			var obj = JSON.parse(result)
			//alert(""+obj.html);
			editor.getSession().setValue(obj.html);
			if(callback)
				callback();
		}
   	});
}

	function submitFormData(id)
	{
		//alert($("#codeArea").attr("value"));
		//alert(editor.getSession().getValue());
		var page={};
		if(id)
		{
			myId = id;
		}
		page.id = myId;
		page.html = editor.getSession().getValue();
		page.name="index"
		//alert(JSON.stringify(page));
		$.ajax({
			//url: "http://testdrive.shift.com/getMergedJSandHTML/"+sessionId,
        	url: "http://testdrive.concussionjs.com/pages/updateWhere/?id="+myId,
        	data: JSON.stringify(page),//$("#codeArea").value,
    		type: "post", 
    		success: function(result) 
			{	 
				//alert(result);
				$("#preview").attr({"src":"http://testdrive.concussionjs.com/getPage?id="+ myId + "&pagename=index"});
				$("#admin-app").attr({"src":"http://testdrive.concussionjs.com/admin?id="+ myId});
			}
		});
	}

	function openUpPreviewWindow()
	{
		window.open("http://testdrive.concussionjs.com/getPage?id="+ myId + "&pagename=index");
	}

	</script>

	<link rel="stylesheet" href="main.css">
</head>
<body>

	<input type="radio" name="menu-control" id="menu1" checked>
	<input type="radio" name="menu-control" id="menu2">
	<input type="radio" name="menu-control" id="menu3">
	<input type="radio" name="menu-control" id="menu4">
	<input type="radio" name="menu-control" id="menu5">

	<section id="masthead">
		<header id="logo">concussion<span>js<span></header>
		<nav id="main-menu">
			<label for="menu1">Tutorial</label>
			<label for="menu2">How it works</label>
			<label for="menu3">Documentation</label>
			<label for="menu4">Download</label>
			<label for="menu5">About</label>
			<div id="menu-indicator"></div>
		</nav>
		<div id="auth-status">
			<div id="auth-loggedout">
				Login via <a class="masthead-icon" id="masthead-icon-facebook" title="Facebook"></a><a class="masthead-icon" id="masthead-icon-twitter" title="Twitter"></a><a class="masthead-icon" id="masthead-icon-github" title="GitHub"></a>
			</div>
			<div id="auth-loggedin" class="auth-hide">
				<span id="auth-displayname">Benjamin Frenkel</span>
				<div id="auth-logoutlink" class="fb-login-button" data-width="200" data-max-rows="1"><a class="fb_button fb_button_medium"><span class="fb_button_text">Log Out</span></a></div>
			</div>
		</div>
	</section>
	
	<div id="pages">
		<div id="page-wrapper">
	
			<section id="tutorial" class="page">

				<input type="radio" name="step-control" id="step1" checked>
				<input type="radio" name="step-control" id="step2">
				<input type="radio" name="step-control" id="step3">
				<input type="radio" name="step-control" id="step4">
				<input type="radio" name="step-control" id="step5">
				<input type="radio" name="step-control" id="step6">
				<input type="radio" name="step-control" id="step7">
				<input type="radio" name="step-control" id="step8">
		
				<section id="instructions" class="panel">
					<header id="step-number">
						<div id="step-number-wrapper">
							<h1>Step 1</h1>
							<h1>Step 2</h1>
							<h1>Step 3</h1>
							<h1>Step 4</h1>
							<h1>Step 5</h1>
							<h1>Step 6</h1>
							<h1>Step 7</h1>
							<h1>Step 8</h1>
						</div>
					</header>
					<div id="next-prev">
						<label for="step1"></label>
						<label for="step2"></label>
						<label for="step3"></label>
						<label for="step4"></label>
						<label for="step5"></label>
						<label for="step6"></label>
						<label for="step7"></label>
						<label for="step8"></label>
					</div>
					<div id="steps">
						<div id="step-wrapper">
							<article>
								<header><span id="lede">The web app platform for the impatient hacker.<span></header>
								<p>In just 5 minutes you'll have finished this 8 step tutorial and be able to show off your first app.</p>
								<p>You provide the HTML. Concussion will use the markup to generate the web services, JS, and admin tools to make your app work.</p>
								<p>To start, copy and paste the text below into the editor and hit save.</p>
<pre>
&lt;form&gt;
    First Name: &lt;input type="text"&gt;
    Last Name: &lt;input type="text"&gt;
    &lt;input type="submit"&gt;
&lt;/form&gt;
</pre>
							<p><label for="step2">Continue &raquo;</label></p>
							</article>
							<article>
								<header>These are the instructions for step 2.</header>
								<p>Add bindings for list and fields and save (editor and preview)</p>
								<p><label for="step3">Continue &raquo;</label></p>
							</article>
							<article>
								<header>These are the instructions for step 3.</header>
								<p>Create records in preview and watch the contacts appear (editor and preview)</p>
								<p><label for="step4">Continue &raquo;</label></p>
							</article>
							<article>
								<header>These are the instructions for step 4.</header>
								<p>Go to admin and see objects, records, and fields (admin)</p>
								<p><label for="step5">Continue &raquo;</label></p>
							</article>
							<article>
								<header>These are the instructions for step 5.</header>
								<p>Add new field and bindings, and save (editor and preview).</p>
								<p><label for="step6">Continue &raquo;</label></p>
							</article>
							<article>
								<header>These are the instructions for step 6.</header>
								<p>Go back to admin and see the change (admin)</p>
								<p><label for="step7">Continue &raquo;</label></p>
							</article>
							<article>
								<header>These are the instructions for step 7.</header>
								<p>Add/update records to use the new field</p>
								<p><label for="step8">Continue &raquo;</label></p>
							</article>
							<article>
								<header>These are the instructions for step 8.</header>
								<p>Done, app url, login, next steps, etc.</p>
							</article>
						</div>
					</div>
					<div id="page-indicator">
						<label for="step1"></label>
						<label for="step2"></label>
						<label for="step3"></label>
						<label for="step4"></label>
						<label for="step5"></label>
						<label for="step6"></label>
						<label for="step7"></label>
						<label for="step8"></label>
					</div>
				</section>

				<section id="workspace">
					<section id="workspace-wrapper">
						<section id="front-end">
							<section id="markup" class="panel">
								<header class="panel-header">
									<div class="panel-header-primary"><a class="panel-header-icon" id="panel-header-icon-save" title="Save"></a></div>
									<div class="panel-header-title">Editor</div>
									<div class="panel-header-secondary"></div>
								</header>
								<div class="panel-body">
									<div id="editor"></div>
								</div>
							</section>
							<section id="view" class="panel">
								<header class="panel-header">
									<div class="panel-header-primary"></div>
									<div class="panel-header-title">Preview</div>
									<div class="panel-header-secondary"><a class="panel-header-icon" id="panel-header-icon-new-window" title="Open in a new window" onclick="openUpPreviewWindow()"></a></div>
								</header>
								<div class="panel-body">
									<iframe src="contacts.html" id="preview"></iframe>
								</div>
							</section>
						</section>

						<section id="admin" class="panel">
							<header class="panel-header">
								<div class="panel-header-primary"></div>
								<div class="panel-header-title">Admin</div>
								<div class="panel-header-secondary"></div>
							</header>
							<div class="panel-body">
								<iframe src="Admin.htm" id="admin-app"></iframe>
							</div>
						</section>
				
					</section>
			
				</section>
	
			</section>

			<section id="howitworks" class="page">
				<img src="infographic.png">
			</section>

			<section id="documentation" class="page">
				Documentation
			</section>

			<section id="download" class="page">
				Download
			</section>

			<section id="about" class="page">
				About
			</section>
			
		</div>
	</div>

<script>

function getSizables() {
	sizables = new Array();
	sizables[0] = document.getElementById("editor");
	sizables[1] = document.getElementById("preview");
	sizables[2] = document.getElementById("admin-app");
	resizeSizables();
}

function resizeSizables() {
	var parent;
	for( var i=0; i<sizables.length; i++ ) {
		parent = sizables[i].parentNode;
		sizables[i].style.width = parent.offsetWidth -1 + "px";
		sizables[i].style.height = parent.offsetHeight -2 + "px";
	}
}
getSizables();
window.onresize = resizeSizables;

var iPadLabels = function () {
	function fix() {
		var labels = document.getElementsByTagName('label'), 
		target_id, 
		el;
		for (var i = 0; labels[i]; i++) {
			if (labels[i].getAttribute('for')) {
				labels[i].onclick = labelClick;
			}
		}
	};
	function labelClick() {
		el = document.getElementById(this.getAttribute('for'));
		if (['radio', 'checkbox'].indexOf(el.getAttribute('type')) != -1) {
			el.setAttribute('selected', !el.getAttribute('selected'));
		} else {
			el.focus();
		}
	};
	return {
		fix: fix
	}
}();

window.onload = function () {
	iPadLabels.fix();
	}

</script>	

</body>
</html>
