<html>
	<head>
		<!--meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;"-->
		<title>concussion</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<!--link rel="stylesheet" href="assets/css/reset.css" type="text/css"-->
		<link rel="stylesheet" href="assets/css/styles.css" type="text/css">
		<script src="assets/js/jquery.js" type="text/javascript"></script>
		<script src="assets/js/cjs-utilities.js" type="text/javascript"></script>
		<script src="ace-0.2.0/src/ace.js" type="text/javascript"></script>
		<script src="ace-0.2.0/src/theme-twilight.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/theme-clouds.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/theme-clouds_midnight.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/theme-dawn.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/theme-cobalt.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/theme-eclipse.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/theme-textmate.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace-0.2.0/src/mode-html.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

		  var myId = "";
		 (function(d){
 		    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
 		    if (d.getElementById(id)) {return;}
 		    js = d.createElement('script'); js.id = id; js.async = true;
 		    js.src = "//connect.facebook.net/en_US/all.js";
 		    ref.parentNode.insertBefore(js, ref);
 		  }(document));

 		window.fbAsyncInit = function() {
 		   FB.init({
		 	 appId      : '231629423618271', // App ID
 		     //channelUrl : 'http://concussionjs.COM/channel.html', // Channel File
 		     status     : true, // check login status
 		     cookie     : true, // enable cookies to allow the server to access the session
 		     xfbml      : true  // parse XFBML
 		   });
		
 		   // Additional initialization code here

 		 // Load the SDK Asynchronously
 		

 		    // listen for and handle auth.statusChange events
        FB.Event.subscribe('auth.statusChange', function(response) {
        	//alert(JSON.stringify(response));
          if (response.authResponse) {
            // user has auth'd your app and is logged into Facebook
            FB.api('/me', function(me){
         		//alert(JSON.stringify(me));
				myId = me.id;
				//alert(myId);
				if (me.name) {
					document.getElementById('auth-displayname').innerHTML = me.name;
				}
				getPage(myId,"index",submitFormData);
            })
            document.getElementById('auth-loggedout').style.display = 'none';
            document.getElementById('auth-loggedin').style.display = 'block';
          } else {
            // user has not auth'd your app, or is not logged into Facebook
            document.getElementById('auth-loggedout').style.display = 'block';
            document.getElementById('auth-loggedin').style.display = 'none';
          }
        });

        // respond to clicks on the login and logout links
        $('#auth-loginlink').click(function(){FB.login();});
        $('#auth-logoutlink').click(function(){FB.logout();}); 
      } 



			
			// wait for the page to finish loading before accessing the DOM
			var editor;
			var tutorialStepNumber=0;
			$(document).ready(function(){

				$("#continue").click(getNextStep);
				// get the textarea
				if(!readCookie("sessionId"))
				{
					//alert("inside no cookie");
					createCookie("sessionId",createUUID(),1);
				}
				
				if(!readCookie("tutorialStepNumber"))
				{
					//alert("inside no cookie");
					createCookie("tutorialStepNumber",tutorialStepNumber,1);
				}
				else
				{
					tutorialStepNumber = readCookie("tutorialStepNumber");
				}

				var JavaScriptMode = require("ace/mode/html").Mode;
    			
				editor = ace.edit("editor");
				editor.setTheme("ace/theme/eclipse");
				editor.getSession().setMode(new JavaScriptMode());
				$(document).keydown(function(objEvent) {
    				if (objEvent.keyCode == 9) {  //tab pressed
        				//objEvent.preventDefault(); // stops its action
        				submitFormData();
    				}
				})

				getTutorialStep(tutorialStepNumber);

				$("#preview").mouseover(function(event){
					submitFormData();
				});
				if(!myId)
				{
					editor.getSession().setValue("<html>\n\t<body>\n\t\t<div data-bind=\"foreach:saturday\"><br>\n\t\t\t<span data-bind=\"text:questionTitle\"></span> - \n\t\t\t<span data-bind=\"text:questionBody\"></span>\n\t\t</div>\n\t\t<form data-bind=\"submit:saturday_create\">\n\t\t\tQuestion title\n\t\t\t<input data-bind=\"value:saturday_questionTitle\"><br>\n\t\t\tQuestion body \n\t\t\t<input data-bind=\"value:saturday_questionBody\"></br>\n\t\t\t<input type=\"submit\" value=\"add question\">\n\t\t</form>\n\t</body>\n</html>");

					submitFormData(readCookie("sessionId"));
				}
				else
				{
					getPage(myId,"next");
				}	
			});

			function getTutorialStep(stepNumber,callback)
			{
				//alert(stepNumber);
				$.ajax({
							//url: "http://testdrive.shift.com/getMergedJSandHTML/"+sessionId,
            				url: "http://testdrive.concussionjs.com/tutorial/getEntryWhere/?stepNumber="+stepNumber,
            				type: "get", 
            				dataType:"text",
            				success: function(result) 
							{ 
								var obj = JSON.parse(result)
								//alert(""+obj.html);
								//editor.getSession().setValue(obj.html);
								document.getElementById('instructions_title').innerHTML=obj.title;
								document.getElementById('instructions_instructions').innerHTML=obj.instructions;
								if(callback)
									callback(obj);
							}
        		});
			}

			function getNextStep()
			{
				tutorialStepNumber = parseInt(readCookie("tutorialStepNumber"))+1;
				createCookie("tutorialStepNumber",tutorialStepNumber,1)
				getTutorialStep(tutorialStepNumber);
			}

			function getPage(userId,filename,callback)
			{
				$.ajax({
							//url: "http://testdrive.shift.com/getMergedJSandHTML/"+sessionId,
            				url: "http://testdrive.concussionjs.com/pages/getEntryWhere/?id="+userId+"&name="+filename,
            				type: "get", 
            				dataType:"text",
            				success: function(result) 
							{ 
								var obj = JSON.parse(result)
								//alert(""+obj.html);
								editor.getSession().setValue(obj.html);
								if(callback)
									callback();
							}
        		});
			}

			function submitFormData(id)
			{
				//alert($("#codeArea").attr("value"));
				//alert(editor.getSession().getValue());
				var page={};
				if(id)
				{
					myId = id;
				}
				page.id = myId;
				page.html = editor.getSession().getValue();
				page.name="index"
				//alert(JSON.stringify(page));
				$.ajax({
							//url: "http://testdrive.shift.com/getMergedJSandHTML/"+sessionId,
            				url: "http://testdrive.concussionjs.com/pages/updateWhere/?id="+myId,
            				data: JSON.stringify(page),//$("#codeArea").value,
            				type: "post", 
            				success: function(result) 
							{ 
								//alert(result);
								$("#preview").attr({"src":"http://testdrive.concussionjs.com/getPage?id="+ myId + "&pagename=index"});
							}
        		});


			}
		</script>
		<header>
			<nav>
				<!--div id="auth-status"-->
					<div id="logo-title">
						<!--img id="logo" src="assets/img/cjs-logo-small.png"-->ConcussionJS
					</div>

						<div id="auth-loggedout">
          					<div class="fb-login-button" data-width="200" data-max-rows="1">
          					</div>
        				</div>
						<div id="auth-loggedin" style="display:none;color:white;">
          					<span id="auth-displayname"></span>
 <a href='https://accounts.google.com/o/oauth2/auth?state=%2Fprofile&redirect_uri=http://testdrive.concussionjs.com&response_type=code&client_id=875190851080.apps.googleusercontent.com&approval_prompt=force&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile'>Login</a>
          					<a id="auth-logoutlink" href=""><img src="assets/img/fb-logout.gif"></a>  		
      					</div>
      			<!--/div-->
      					<div id="fb-wrapper">
							<div class="fb-like" data-href="http://testdrive.concussionjs.com" data-send="false" data-width="25" data-show-faces="false" data-colorscheme="dark" data-font="lucida grande">
							</div>
      					</div>

			</nav>
				
			<div id="fb-root"></div>
			<!--div id="cjs-header-wrapper">
				<img id="logo" src="assets/img/logo.png">
				<div id="logo-text">ConcussionJS</div>
				<br><br>
				<div id="chalk-text">build your first app in 5 minutes</div>
				<img id="chalk-img" src="assets/img/chalk-arrow.png">
			</div-->
			
      		
		</header>
	</head>
	<body>
		<section id="instructions">
		<b><div id="instructions_title">Let's begin by learning a few of the basics!</div></b><br><br>
		<div id="instructions_instructions">With ConcussionJS you can create powerful web apps without having<br>to know anything but HTML,CSS and Javascript.</div>
		<button id="continue">Continue</button>
		</section>	
		<section id="interface">
			<div id="editorWrapper">
				<div id="editor">	
				</div>
			</div>
			<!--div id="previewWrapper"-->
				<iframe src="" id="preview"> 
				</iframe>
			<!--/div-->
		
		</section>
		<!--section id="previewWrapper">
				<iframe src="" id="preview"> 
				</iframe>
			</section-->
		<!--div id="editorWrapper">	
			<div id="editor">
			</div>
			<iframe src="" id="preview"> 
			</iframe>
		</div-->
	</body>
</html>